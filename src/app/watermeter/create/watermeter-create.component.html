<div class="app-container">
  <app-header></app-header>

  <div class="main-content-container">
    <app-sidebar></app-sidebar>

    <main class="content-area">
      <!-- Header Section -->
      <div class="content-header">
        <div class="header-content">
          <div class="title-section">
            <button mat-icon-button class="back-button" (click)="onCancel()">
              <mat-icon>arrow_back</mat-icon>
            </button>
            <div>
              <h2><mat-icon class="header-icon">water</mat-icon> Create Water Meter</h2>
              <p class="subtitle">Add a new water meter to the monitoring system</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Card -->
      <mat-card class="form-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>add_circle</mat-icon>
            Water Meter Information
          </mat-card-title>
          <mat-card-subtitle>Fill in the details for the new water meter</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <form [formGroup]="waterMeterForm" (ngSubmit)="onSubmit()" class="meter-form">
            <div class="form-grid">
              <!-- Serial Number Field -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Serial Number</mat-label>
                <input matInput formControlName="serialNumber" placeholder="Enter unique serial number" />
                <mat-icon matPrefix>confirmation_number</mat-icon>
                <mat-hint>Required field. Maximum 50 characters.</mat-hint>
                <mat-error *ngIf="waterMeterForm.controls.serialNumber.invalid">
                  <span *ngIf="waterMeterForm.controls.serialNumber.errors?.['required']">
                    Serial number is required
                  </span>
                  <span *ngIf="waterMeterForm.controls.serialNumber.errors?.['maxlength']">
                    Serial number cannot exceed 50 characters
                  </span>
                </mat-error>
              </mat-form-field>

              <!-- Branch ID Field -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Branch ID</mat-label>
                <input matInput formControlName="branchId" placeholder="Enter branch identifier" />
                <mat-icon matPrefix>business</mat-icon>
                <mat-hint>Required field</mat-hint>
                <mat-error *ngIf="waterMeterForm.controls.branchId.invalid">
                  <span *ngIf="waterMeterForm.controls.branchId.errors?.['required']">
                    Branch ID is required
                  </span>
                </mat-error>
              </mat-form-field>

              <!-- Status Field -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Status</mat-label>
                <mat-select formControlName="status">
                  <mat-option *ngFor="let status of statusOptions" [value]="status">
                    <div class="status-option">
                      <mat-icon [class]="'status-icon-' + status.toLowerCase()">
                        {{ getStatusIcon(status) }}
                      </mat-icon>
                      {{ status }}
                    </div>
                  </mat-option>
                </mat-select>
                <mat-icon matPrefix>status</mat-icon>
                <mat-hint>Select the current status of the water meter</mat-hint>
              </mat-form-field>

              <!-- Installed At -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Installed At</mat-label>
                <input matInput [matDatepicker]="installedPicker" formControlName="installedAt" placeholder="Optional installation date" />
                <mat-datepicker-toggle matSuffix [for]="installedPicker"></mat-datepicker-toggle>
                <mat-datepicker #installedPicker></mat-datepicker>
              </mat-form-field>

              <!-- Last Maintenance -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Last Maintenance</mat-label>
                <input matInput [matDatepicker]="maintenancePicker" formControlName="lastMaintenance" placeholder="Optional last maintenance date" />
                <mat-datepicker-toggle matSuffix [for]="maintenancePicker"></mat-datepicker-toggle>
                <mat-datepicker #maintenancePicker></mat-datepicker>
              </mat-form-field>

              <!-- Meter Type -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Meter Type</mat-label>
                <input matInput formControlName="meterType" placeholder="Optional meter type (e.g., Analog, Digital)" />
              </mat-form-field>

              <!-- Additional Information Section -->
              <div class="info-section">
                <h3 class="section-title"><mat-icon>info</mat-icon> Additional Information</h3>
                <p class="section-description">
                  Water meters are used to monitor water consumption across Poulina branches. 
                  Ensure the serial number is unique and matches the physical device.
                </p>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
              <button mat-raised-button color="primary" type="submit" 
                      [disabled]="isSubmitting || waterMeterForm.invalid" class="submit-button">
                <mat-icon>{{ isSubmitting ? 'hourglass_empty' : 'add_circle' }}</mat-icon>
                {{ isSubmitting ? 'Creating...' : 'Create Water Meter' }}
              </button>

              <button mat-stroked-button color="warn" type="button" (click)="onCancel()" class="cancel-button">
                <mat-icon>cancel</mat-icon>
                Cancel
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </main>
  </div>

  <app-footer></app-footer>
</div>
