<nav class="sidebar">
  <ul>
    <li *ngFor="let item of menu">
      <!-- If the item has children -->
      <ng-container *ngIf="item.children?.length; else singleLink">
        <div class="group-header" (click)="toggleGroup(item.label)">
          <mat-icon>{{ item.icon }}</mat-icon>
          <span>{{ item.label }}</span>
          <mat-icon class="chevron" [class.rotated]="openGroups[item.label]">expand_more</mat-icon>
        </div>
        <ul class="sidebar-submenu" *ngIf="openGroups[item.label]">
          <li *ngFor="let child of item.children">
            <ng-container *ngIf="child.children?.length; else leafLink">
              <div class="group-header" (click)="toggleGroup(child.label)">
                <mat-icon>{{ child.icon }}</mat-icon>
                <span>{{ child.label }}</span>
                <mat-icon class="chevron" [class.rotated]="openGroups[child.label]">expand_more</mat-icon>
              </div>
              <ul class="sidebar-submenu" *ngIf="openGroups[child.label]">
                <li *ngFor="let grand of child.children">
                  <a [routerLink]="grand.route" routerLinkActive="active">
                    <mat-icon>{{ grand.icon }}</mat-icon>
                    <span>{{ grand.label }}</span>
                  </a>
                </li>
              </ul>
            </ng-container>
            <ng-template #leafLink>
              <a [routerLink]="child.route" routerLinkActive="active">
                <mat-icon>{{ child.icon }}</mat-icon>
                <span>{{ child.label }}</span>
              </a>
            </ng-template>
          </li>
        </ul>
      </ng-container>

      <!-- If the item has no children -->
      <ng-template #singleLink>
        <a [routerLink]="item.route" routerLinkActive="active">
          <mat-icon>{{ item.icon }}</mat-icon>
          <span>{{ item.label }}</span>
        </a>
      </ng-template>
    </li>
  </ul>
</nav>
