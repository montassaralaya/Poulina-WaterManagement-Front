<div class="auth-container">
  <div class="auth-card">
    <div class="auth-header">
  <a routerLink="/" class="water-logo-link">
    <div class="water-logo">
      <mat-icon class="water-icon">water_drop</mat-icon>
      <h1>Poulina Water</h1>
    </div>
  </a>
  <h2>Create your account</h2>
  <p>Start managing water resources efficiently</p>
</div>

    <!-- Success Message Section -->
    <div *ngIf="isSuccess" class="success-message">
      <mat-icon class="success-icon">check_circle</mat-icon>
      <h3>Registration Successful!</h3>
      <p>Your account has been created successfully.</p>
      <p>You will be redirected to login in 3 seconds...</p>
      <button mat-raised-button color="primary" (click)="redirectNow()">
        Go to Login Now
      </button>
    </div>

    <!-- Registration Form (hidden when success is shown) -->
    <form *ngIf="!isSuccess" [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>First Name</mat-label>
          <input matInput formControlName="firstName" placeholder="John" required>
          <mat-icon matPrefix>person</mat-icon>
          <mat-error *ngIf="registerForm.get('firstName')?.hasError('required')">
            First name is required
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Last Name</mat-label>
          <input matInput formControlName="lastName" placeholder="Doe" required>
          <mat-error *ngIf="registerForm.get('lastName')?.hasError('required')">
            Last name is required
          </mat-error>
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline">
        <mat-label>Email Address</mat-label>
        <input matInput formControlName="email" placeholder="name@company.com" required>
        <mat-icon matPrefix>alternate_email</mat-icon>
        <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
          Email is required
        </mat-error>
        <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
          Please enter a valid email
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Username</mat-label>
        <input matInput formControlName="username" placeholder="Enter username" required>
        <mat-icon matPrefix>account_circle</mat-icon>
        <mat-error *ngIf="registerForm.get('username')?.hasError('required')">
          Username is required
        </mat-error>
      </mat-form-field>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Password</mat-label>
          <input matInput formControlName="password" 
                 [type]="showPassword ? 'text' : 'password'" 
                 placeholder="••••••••" required>
          <mat-icon matPrefix>lock</mat-icon>
          <button mat-icon-button matSuffix (click)="togglePasswordVisibility()" type="button">
            <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
            Password is required
          </mat-error>
          <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
            Password must be at least 6 characters
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Confirm Password</mat-label>
          <input matInput formControlName="confirmPassword" 
                 [type]="showPassword ? 'text' : 'password'" 
                 placeholder="••••••••" required>
          <mat-icon matPrefix>lock_reset</mat-icon>
          <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
            Please confirm your password
          </mat-error>
          <mat-error *ngIf="registerForm.hasError('mismatch')">
            Passwords do not match
          </mat-error>
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline">
        <mat-label>Phone</mat-label>
        <input matInput formControlName="phone" placeholder="(123) 456-7890">
        <mat-icon matPrefix>phone</mat-icon>
        <mat-error *ngIf="registerForm.get('phone')?.hasError('pattern')">
          Please enter a valid phone number (10 digits)
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Role</mat-label>
        <mat-select formControlName="role" required>
          <mat-option value="branchmanager">Branch Manager</mat-option>
          <mat-option value="hqadmin">HQ Admin</mat-option>
          <mat-option value="regionaladmin">Regional Admin</mat-option>
        </mat-select>
        <mat-icon matPrefix>badge</mat-icon>
        <mat-error *ngIf="registerForm.get('role')?.hasError('required')">
          Role is required
        </mat-error>
      </mat-form-field>

      <mat-checkbox formControlName="terms" required>
        I agree to the Terms of Service and Privacy Policy
      </mat-checkbox>
      <mat-error *ngIf="registerForm.get('terms')?.hasError('required')">
        You must accept the terms
      </mat-error>

      <!-- Error message display -->
      <div *ngIf="errorMessage" class="error-message">
        <mat-icon>error</mat-icon>
        {{ errorMessage }}
      </div>

      <button mat-raised-button color="primary" class="auth-button" 
              [disabled]="registerForm.invalid || isLoading">
        <span *ngIf="!isLoading">Create Account</span>
        <mat-spinner *ngIf="isLoading" diameter="24"></mat-spinner>
      </button>

      <div class="auth-footer">
        <p>Already have an account? <a routerLink="/login">Sign in</a></p>
      </div>
    </form>
  </div>

  <div class="auth-water-bg">
    <div class="water-overlay"></div>
    <div class="water-text">
      <h3>Sustainable Water Management</h3>
      <p>Advanced monitoring and control for water distribution networks</p>
    </div>
  </div>
</div>